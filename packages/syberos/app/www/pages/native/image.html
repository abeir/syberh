<!DOCTYPE html>
<html lang="zh-CN">

<head>
  <meta charset="utf-8">
  <meta http-equiv="pragma" content="no-cache">
  <meta http-equiv="cache-control" content="no-cache">
  <meta http-equiv="expires" content="0">
  <meta name="viewport" content="width=device-width, initial-scale=1,maximum-scale=1,user-scalable=no">
  <title>scan</title>
  <link rel="stylesheet" href="../../common/mui/mui.css" />
  <link rel="stylesheet" href="../../common/common.css" />
  <style>
    .pt0 {
      margin-top: 1em;
    }
    .mui-card-content .mui-input-group {
        margin: 15px;
    }
    .mui-input-group .group-row {
        padding-top: 10px;
        padding-left: 10px;
    }
  </style>
</head>

<body>
  <div class="mui-content pt0">
    <div class="mui-card">
      <div class="mui-card-header">
        原生图片
      </div>
      <div class="mui-card-content">
        <div class="mui-input-group">
            <p>
              Test content
            </p>
            <div id="image-content" style="width:230px;height:230px"></div>
        </div>
      </div>
      <div class="mui-card-footer">
        <button class="mui-btn mui-btn-outlined" onclick="changeImage()">Change Image</button>
        <button class="mui-btn mui-btn-outlined" onclick="testChangeImage()">Test Change Image</button>
      </div>
    </div>
  </div>

  <script type="text/javascript" src="../../common/mui/mui.js"></script>
  <script type="text/javascript" src="../../lib/syberh.min.js"></script>
  <script type="text/javascript" src="../../common/common.js"></script>
  <script type="text/javascript" src="../../lib/vconsole.min.js"></script>
  <script>
    var imageId;
    (function(){
      var vConsole = new VConsole();
      var imageContent = document.getElementById('image-content');
      var offsetSize = offset(imageContent);

      syberh.nativeImage.create({
        src: 'file:///home/user/ScreenShot/20201029185206.png',
        width: imageContent.style.width,
        height: imageContent.style.height,
        offsetTop: offsetSize.top,
        offsetLeft: offsetSize.left,
        success: function (result) {
          imageId = result.id
        },
        fail: function (error) {
          console.log(error)
        }
      })
    })()



    function changeImage(){
      syberh.nativeImage.change({
        id: imageId,
        src: 'file:///data/apps/com.syberos.example/www/images/playR.png'
      })
    }

    function testChangeImage(){
      var images = [
        'file:///home/user/ScreenShot/20201018214534.png',
        'file:///home/user/ScreenShot/20201029185159.png',
        'file:///home/user/ScreenShot/20201029185206.png',
        'file:///home/user/ScreenShot/20201109192802.png',
        'file:///home/user/ScreenShot/20201109192807.png',
        'file:///home/user/ScreenShot/20201109192815.png',
        'file:///home/user/ScreenShot/20201109192820.png',
        'file:///home/user/ScreenShot/20201109192825.png',
        'file:///data/apps/com.syberos.example/www/images/playR.png',
      ]

      var i = 0;
      setTimeout(function(){
        var start = new Date().getTime()
        while(true){
          var last = new Date().getTime()
          if(last - start > 10000){
            break
          }
          if(i >= images.length){
            i = 0;
          }
          syberh.nativeImage.change({
            id: imageId,
            src: images[i]
          })
          i++;
        }
      })
    }

    function offset(curEle){
      var totalLeft = null,totalTop = null,par = curEle.offsetParent;
      //首先把自己本身的进行累加
      totalLeft += curEle.offsetLeft;
      totalTop += curEle.offsetTop;

      //只要没有找到body，我们就把父级参照物的边框和偏移量累加
      while(par){
              if(navigator.userAgent.indexOf("MSIE 8.0") === -1){
                  //不是标准的ie8浏览器，才进行边框累加
                  //累加父级参照物边框
                  totalLeft += par.clientLeft;
                  totalTop += par.clientTop;
              }
              //累加父级参照物本身的偏移
              totalLeft += par.offsetLeft;
              totalTop += par.offsetTop;
              par = par.offsetParent;
      }
      return {left:totalLeft,top:totalTop};
    }

  </script>
</body>

</html>